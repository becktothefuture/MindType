<!--══════════════════════════════════════════════════════════
  ╔══════════════════════════════════════════════════════════════╗
  ║  ░  V 0 . 3   G A P   R E P O R T  ░░░░░░░░░░░░░░░░░░░░░░░░  ║
  ║                                                              ║
  ║                                                              ║
  ║                                                              ║
  ║                                                              ║
  ║           ╌╌  P L A C E H O L D E R  ╌╌                      ║
  ║                                                              ║
  ║                                                              ║
  ║                                                              ║
  ║                                                              ║
  ╚══════════════════════════════════════════════════════════════╝
    • WHAT ▸ Spec→code gap analysis for MindTyper v0.3
    • WHY  ▸ Drive implementation with clear, testable deltas
    • HOW  ▸ Table: Spec item | Current impl | Gap | Proposed task
-->

# MindTyper v0.3 Gap Report

Date: 2025-08-26

| Spec item                                                       | Current impl                                                                                     | Gap                                                                                                      | Proposed task                                     |
| --------------------------------------------------------------- | ------------------------------------------------------------------------------------------------ | -------------------------------------------------------------------------------------------------------- | ------------------------------------------------- |
| Privacy (on‑device; secure fields; IME no‑op)                   | `core/security.ts`, `ui/securityDetection.ts` gate secure fields and IME; LM defaults local‑only | Ensure central scheduler universally respects gates; extend tests; cross‑platform bindings enforce no‑op | FT-301, FT-303, FT-308, FT-309                    |
| Caret safety + rollback on caret entry                          | `utils/diff.ts` clamps edits before caret; TS `streamMerge` emits rollback                       | Rust core lacks caret‑safe merge/apply; no unified rollback at core level                                | FT-302 (apply_span + UTF‑16 safe), FT-309         |
| Active Region (3–8 words)                                       | `core/diffusionController.ts` computes band; configurable                                        | Not exposed via Rust/FFI; policy not shared                                                              | FT-302 (expose band params), FT-303               |
| Visuals: mechanical swap only; marker ⠿; reduced‑motion instant | `ui/highlighter.ts` emits highlight/activeRegion events                                          | Uses highlights; no mechanical swap renderer; no marker glyph                                            | FT-307 (new `ui/swapRenderer.ts`), FT-309         |
| Performance targets                                             | Tests green; no benches; LM token caps in policy                                                 | No p95 bench/guard; scheduler cooldown single‑flight spread across LM client, not core                   | FT-303 (cooldown/single‑flight), FT-504 (benches) |
| Cross‑platform core (Rust FFI + WASM)                           | Crate exists; caret monitor present; FFI only version/free; merge is stub append                 | Missing merge gate API; no wasm-bindgen apply_span; memory helpers minimal                               | FT-302, FT-500/501                                |
| Caret Monitor (typing/pause/caret_entered_active_region)        | TS `typingMonitor.ts` minimal; Rust `caret_monitor.rs` rich                                      | Not integrated; no `caret_entered_active_region` surfaced to hosts                                       | FT-301 (adopt Rust monitor via WASM/C FFI)        |
| Scheduler (single‑flight + cooldown)                            | `core/sweepScheduler.ts` timers; LM client has single‑flight/cooldown                            | Not centralized; no abort routing for all transformers                                                   | FT-303 (new core scheduler)                       |
| Transformers: Noise                                             | Rules live in `engines/noiseTransformer.ts`; no separate noise module                            | Need fast micro‑fixes with reason codes and confidences                                                  | FT-304                                            |
| Transformers: Context (local LM)                                | `core/lm/*` and `mergePolicy.ts` stream LM tokens                                                | Constrain to Active Region via Rust gate; orchestrate on pause                                           | FT-305                                            |
| Transformers: Tone                                              | None                                                                                             | Implement light, post‑Context normalizations                                                             | FT-306                                            |
| Diff/Merge Gate (Rust)                                          | `merge.rs` stub; no caret clamp/UTF‑16/undo buckets                                              | Implement real gate + undo buckets + exports                                                             | FT-302                                            |
| UI Renderer (mechanical swap)                                   | None                                                                                             | Implement swap renderer; SR announcement once per batch                                                  | FT-307                                            |
| Platform bindings                                               | None                                                                                             | Swift stub + Windows TSF/.NET stub + Web WASM wiring                                                     | FT-308                                            |
| Tests (caret safety, rollback, visuals)                         | Many TS tests; Playwright present                                                                | Need swap renderer tests and rollback e2e                                                                | FT-309                                            |
| Docs to v0.3 only                                               | v0.2 language persists (highlights, TidySweep)                                                   | Rewrite and remove underline/highlight wording                                                           | FT-310                                            |

Notes:

- Rust `caret_monitor.rs` already models pause/cadence and selection; adopt as the canonical monitor via FFI/WASM.
- Deprecate `ui/highlighter.ts` after FT‑307 lands; mechanical swap becomes the only visual.
- LM remains local‑only by default; ensure no outbound text across bindings.

---

Traceability: See “Stage — v0.3 Migration” in `docs/implementation.md` for ordered tasks and acceptance.
