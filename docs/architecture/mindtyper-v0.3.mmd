%% MindTyper v0.3 Architecture Diagram
flowchart LR
    subgraph Input
        A["Keystrokes"]
        B["Caret Monitor"]
    end
    subgraph Guards
        S["Security/IME Gate<br>Secure fields + IME = no-op"]
    end
    subgraph Scheduler
        C["State Router<br>typing/pause/caret_entered"]
    end
    subgraph Transformers
        D["NoiseTransformer"]
        E["ContextTransformer<br>(Local LM: WebGPU → WASM → CPU)"]
        F["ToneTransformer"]
    end
    subgraph Core
        G["Diff/Merge Gate (Rust)<br>Clamp + Rollback"]
        H["Undo Buckets"]
    end
    subgraph Output
        I["UI Renderer<br>Mechanical Swap Only"]
        J["Platform Bindings<br>macOS / Windows / Web"]
    end
    A --> B --> S --> C
    C --> D
    C --> E
    C --> F
    D --> G
    E --> G
    T{{"Device Tier Detector"}} -.-> E
    F --> G
    G --> H --> I --> J


