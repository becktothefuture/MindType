%%{init: {'theme': 'base', 'themeVariables': {'primaryColor': '#e3f2fd', 'primaryTextColor': '#0d47a1', 'primaryBorderColor': '#1976d2', 'lineColor': '#424242', 'secondaryColor': '#f3e5f5', 'tertiaryColor': '#e8f5e8', 'background': '#fafafa', 'mainBkg': '#ffffff', 'secondBkg': '#f5f5f5', 'tertiaryBkg': '#eeeeee'}}}%%
%% ═══════════════════════════════════════════════════════════════════════════════
%% 🚀 MINDTYPE REVOLUTIONARY ARCHITECTURE - CORRECTION MARKER & SEVEN SCENARIOS
%% ═══════════════════════════════════════════════════════════════════════════════
%% 
%% PURPOSE: Revolutionary cognitive augmentation architecture enabling thought-speed typing
%% SCOPE: Correction Marker system with Burst-Pause-Correct methodology
%% VISION: Transform typing from mechanical skill to fluid expression of thought
%% 
%% REVOLUTIONARY FEATURES:
%% 🎆 Correction Marker (Listening Mode → Correction Mode)
%% ⚡ Burst-Pause-Correct Engine (Muscle Memory Training)
%% 🧠 Seven Usage Scenarios (Academic to Speed Mastery)
%% 🎯 Thought-Speed Typing (Cognitive Augmentation)
%% ═══════════════════════════════════════════════════════════════════════════════

graph TB
    %% ═══════════════════════════════════════════════════════════════
    %% 🎯 USER EXPERIENCE LAYER - SEVEN REVOLUTIONARY SCENARIOS
    %% ═══════════════════════════════════════════════════════════════
    subgraph SCENARIOS ["🌟 **SEVEN REVOLUTIONARY SCENARIOS**<br/>🎯 Cognitive Augmentation Across Life Contexts"]
        direction TB
        
        subgraph ACADEMIC ["📚 **ACADEMIC EXCELLENCE**<br/>Maya - PhD with Dyslexia"]
            MAYA[("👩‍🎓 **Maya**<br/>50% faster academic writing<br/>Scientific terminology<br/>Privacy-first research")]
        end
        
        subgraph MULTILINGUAL ["🌍 **MULTILINGUAL MASTERY**<br/>Carlos - Business Analyst"]
            CARLOS[("👨‍💼 **Carlos**<br/>40% faster documents<br/>Cross-language detection<br/>Professional credibility")]
        end
        
        subgraph ACCESSIBILITY ["♿ **ACCESSIBILITY CHAMPION**<br/>Dr. Chen - Visually Impaired"]
            CHEN[("👩‍⚕️ **Dr. Chen**<br/>60% fewer interruptions<br/>Silent corrections<br/>Screen reader optimized")]
        end
        
        subgraph CREATIVE ["✍️ **CREATIVE FLOW**<br/>James - Novelist"]
            JAMES[("👨‍🎨 **James**<br/>35% more words daily<br/>Stream-of-consciousness<br/>Voice preservation")]
        end
        
        subgraph PROFESSIONAL ["💼 **PROFESSIONAL POLISH**<br/>Emma - Working Parent"]
            EMMA[("👩‍💻 **Emma**<br/>90% professional tone<br/>Invisible enhancement<br/>Stolen moment typing")]
        end
        
        subgraph SPEED ["🏎️ **SPEED DEMON**<br/>Marcus - Ex-Stenographer"]
            MARCUS[("⚡ **Marcus**<br/>180+ WPM achieved<br/>Velocity Mode activated<br/>Thought-speed typing")]
        end
        
        subgraph DATA ["📊 **DATA WHISPERER**<br/>Priya - Quantitative Analyst"]
            PRIYA[("📈 **Priya**<br/>5× faster data entry<br/>Custom dialect support<br/>Analytical flow preserved")]
        end
    end
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🎆 CORRECTION MARKER SYSTEM - THE REVOLUTIONARY VISUAL CORE
    %% ═══════════════════════════════════════════════════════════════
    subgraph MARKER_SYSTEM ["🎆 **CORRECTION MARKER SYSTEM**<br/>🧠 Revolutionary Visual Intelligence"]
        direction TB
        
        subgraph LISTENING ["🟢 **LISTENING MODE**<br/>⠂ → ⠄ → ⠆ → ⠠ → ⠢ → ⠤ → ⠦ → ⠰ → ⠲ → ⠴ → ⠶"]
            PULSE_ANIMATION["**🎵 Hypnotic Pulse**<br/>200ms per symbol<br/>2.4s complete cycle<br/>Holds at last position"]
            BURST_DETECTION["**⚡ Burst Detection**<br/>Rapid typing >60 WPM<br/>Marker holds position<br/>Visual listening feedback"]
        end
        
        subgraph CORRECTION ["🔴 **CORRECTION MODE**<br/>🚀 Intelligent Worker Travels"]
            PAUSE_TRIGGER["**⏸️ Pause Trigger**<br/>500ms pause detected<br/>Mode transition begins<br/>Marker accelerates"]
            TRAVEL_ANIMATION["**🌊 Whoosh Effect**<br/>Speed adaptation:<br/>• Noise: 50ms/word<br/>• Context: 150ms/word<br/>• Tone: 300ms/word"]
            PROCESSING_INDICATORS["**🎯 Processing Indicators**<br/>⠁⠂⠄⠈ Noise patterns<br/>⠃⠆⠌ Context patterns<br/>⠷⠿⠷ Tone patterns"]
        end
        
        BURST_PAUSE_ENGINE["**⚡ BURST-PAUSE-CORRECT ENGINE**<br/>🧠 Muscle Memory Training<br/>🔄 Natural Rhythm Development"]
    end
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🧠 COGNITIVE PROCESSING PIPELINE - THREE-STAGE INTELLIGENCE
    %% ═══════════════════════════════════════════════════════════════
    subgraph PIPELINE ["🧠 **COGNITIVE PROCESSING PIPELINE**<br/>⚡ Three-Stage Transformer Architecture"]
        direction TB
        
        subgraph STAGE1 ["**STAGE 1: NOISE TRANSFORMER**<br/>⚡ Sub-millisecond Typo Fixes"]
            NOISE_RULES["**📝 Pattern Matching**<br/>• 'teh' → 'the'<br/>• 'recieve' → 'receive'<br/>• Transposition fixes"]
            NOISE_CONFIDENCE["**🎯 Confidence: 0.95+**<br/>Immediate application<br/>No hesitation needed"]
        end
        
        subgraph STAGE2 ["**STAGE 2: CONTEXT TRANSFORMER**<br/>🧠 LM-Powered Grammar & Flow"]
            CONTEXT_WINDOW["**📖 Context Analysis**<br/>±2 sentences window<br/>S-1 weight: 1.0<br/>S-2 weight: 0.5"]
            LM_PROCESSING["**🤖 Language Model**<br/>English-only processing<br/>Qwen2.5-0.5B-Instruct<br/>WebGPU/WASM/CPU tiers"]
        end
        
        subgraph STAGE3 ["**STAGE 3: TONE TRANSFORMER**<br/>🎨 Optional Style Adjustment"]
            TONE_DETECTION["**🎭 Baseline Detection**<br/>Current tone analysis<br/>User preference respect"]
            TONE_OPTIONS["**🎚️ Tone Modes**<br/>• None (default)<br/>• Casual<br/>• Professional"]
        end
    end
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🛡️ SAFETY & PERFORMANCE LAYER - DEVICE-TIER OPTIMIZATION
    %% ═══════════════════════════════════════════════════════════════
    subgraph SAFETY_PERFORMANCE ["🛡️ **SAFETY & PERFORMANCE LAYER**<br/>⚖️ Caret-Safe + Device-Tier Optimization"]
        direction TB
        
        subgraph CARET_SAFETY ["**🛡️ CARET-SAFE GUARANTEE**<br/>Absolute Protection"]
            ACTIVE_REGION["**📍 Active Region**<br/>20 words behind caret<br/>Never at/after cursor<br/>Safety validation"]
            ROLLBACK_SYSTEM["**↩️ Instant Rollback**<br/>If cursor enters region<br/>Cancel corrections<br/>Preserve user intent"]
        end
        
        subgraph DEVICE_TIERS ["**⚡ DEVICE-TIER OPTIMIZATION**<br/>Adaptive Performance"]
            WEBGPU_TIER["**🚀 WebGPU Tier**<br/>15ms latency<br/>48 token limit<br/>60 FPS marker"]
            WASM_TIER["**⚙️ WASM Tier**<br/>25ms latency<br/>24 token limit<br/>30 FPS marker"]
            CPU_TIER["**🐌 CPU Tier**<br/>30ms latency<br/>16 token limit<br/>15 FPS marker"]
        end
        
        subgraph PRIVACY ["**🔒 PRIVACY-FIRST ARCHITECTURE**<br/>On-Device by Default"]
            LOCAL_PROCESSING["**💻 Local Processing**<br/>WebGPU/WASM models<br/>No text leaves device<br/>Secure field detection"]
            OPTIONAL_REMOTE["**🔐 Optional Remote**<br/>Explicit per-session opt-in<br/>Encrypted transport<br/>No data retention"]
        end
    end
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🎨 VISUAL FEEDBACK SYSTEM - USER EXPERIENCE
    %% ═══════════════════════════════════════════════════════════════
    subgraph VISUAL_SYSTEM ["🎨 **VISUAL FEEDBACK SYSTEM**<br/>✨ Revolutionary User Experience"]
        direction TB
        
        WAKE_EFFECT["**🌊 Wake Effect**<br/>Corrected words highlight<br/>85% opacity fade<br/>Trail behind marker"]
        
        ACCESSIBILITY_LAYER["**♿ ACCESSIBILITY LAYER**<br/>WCAG 2.2 AA Compliance<br/>• Screen reader: 'text updated behind cursor'<br/>• High contrast markers<br/>• Reduced motion support<br/>• Keyboard-only operation"]
        
        VISUAL_CUSTOMIZATION["**🎨 Visual Customization**<br/>• Marker size: 12px-24px<br/>• Color-blind friendly<br/>• Custom braille patterns<br/>• Animation preferences"]
    end
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🔄 REVOLUTIONARY DATA FLOW CONNECTIONS
    %% ═══════════════════════════════════════════════════════════════
    
    %% Scenarios to Marker System
    SCENARIOS ==>|"**User Types**<br/>Burst or Pause"| MARKER_SYSTEM
    
    %% Marker System to Processing
    LISTENING ==>|"**Burst Detected**<br/>Hold & Listen"| BURST_PAUSE_ENGINE
    CORRECTION ==>|"**Pause Detected**<br/>Travel & Correct"| PIPELINE
    
    %% Processing Pipeline Flow
    STAGE1 --> STAGE2
    STAGE2 --> STAGE3
    PIPELINE --> SAFETY_PERFORMANCE
    
    %% Safety to Visual
    SAFETY_PERFORMANCE --> VISUAL_SYSTEM
    
    %% Visual back to Scenarios
    VISUAL_SYSTEM ==>|"**Enhanced Experience**<br/>Thought-Speed Typing"| SCENARIOS
    
    %% Internal Marker System Flow
    BURST_DETECTION --> PAUSE_TRIGGER
    PAUSE_TRIGGER --> TRAVEL_ANIMATION
    TRAVEL_ANIMATION --> PROCESSING_INDICATORS
    
    %% Safety System Flow
    ACTIVE_REGION --> ROLLBACK_SYSTEM
    DEVICE_TIERS --> PRIVACY
    
    %% ═══════════════════════════════════════════════════════════════
    %% 🎨 REVOLUTIONARY VISUAL STYLING
    %% ═══════════════════════════════════════════════════════════════
    
    %% Scenario Colors (Revolutionary Purple Gradient)
    classDef scenario fill:#e1bee7,stroke:#8e24aa,stroke-width:3px,color:#4a148c
    
    %% Correction Marker (Revolutionary Gold)
    classDef marker fill:#fff8e1,stroke:#ff8f00,stroke-width:4px,color:#e65100
    
    %% Processing Pipeline (Revolutionary Blue)
    classDef pipeline fill:#e3f2fd,stroke:#1976d2,stroke-width:3px,color:#0d47a1
    
    %% Safety & Performance (Revolutionary Green)
    classDef safety fill:#e8f5e8,stroke:#388e3c,stroke-width:3px,color:#1b5e20
    
    %% Visual System (Revolutionary Cyan)
    classDef visual fill:#e0f2f1,stroke:#00796b,stroke-width:3px,color:#004d40
    
    %% Apply Revolutionary Styling
    class SCENARIOS,ACADEMIC,MULTILINGUAL,ACCESSIBILITY,CREATIVE,PROFESSIONAL,SPEED,DATA scenario
    class MARKER_SYSTEM,LISTENING,CORRECTION,BURST_PAUSE_ENGINE marker
    class PIPELINE,STAGE1,STAGE2,STAGE3 pipeline
    class SAFETY_PERFORMANCE,CARET_SAFETY,DEVICE_TIERS,PRIVACY safety
    class VISUAL_SYSTEM visual
    
    %% ═══════════════════════════════════════════════════════════════
    %% 📚 REVOLUTIONARY DOCUMENTATION REFERENCES
    %% ═══════════════════════════════════════════════════════════════
    %% 
    %% CORE REVOLUTIONARY DOCUMENTS:
    %% • docs/01-prd/01-PRD.md - Seven Scenarios & Correction Marker specs
    %% • docs/02-implementation/02-Implementation.md - 3-phase development plan
    %% • docs/03-system-principles/03-System-Principles.md - Revolutionary principles
    %% 
    %% ARCHITECTURE EVOLUTION:
    %% • This diagram represents the revolutionary vision (v0.6+)
    %% • Previous architecture.mmd represents legacy dual TS/Rust approach
    %% • Migration path: Enhance existing components toward revolutionary capabilities
    %% ═══════════════════════════════════════════════════════════════
